# LINE Bot å››é …åŠŸèƒ½æ”¹å–„è¨ˆç•«

## 1. æ–°å¢žã€Œå¡«å¯«åŽŸå› ã€æ­¥é©Ÿ

ç›®å‰é¸å®ŒçµæŸæ—¥æœŸå¾Œç›´æŽ¥é€å‡ºç”³è«‹ï¼ˆåŽŸå› ç‚ºç©ºï¼‰ã€‚æ”¹ç‚ºåœ¨é¸å®ŒçµæŸæ—¥æœŸå¾Œï¼Œæ–°å¢žä¸€å€‹æ­¥é©Ÿè®“å“¡å·¥è¼¸å…¥ä¼‘å‡åŽŸå› ã€‚

- é¸å®ŒçµæŸæ—¥æœŸï¼ˆæˆ–é»žã€Œåªè«‹ä¸€å¤©ã€ï¼‰å¾Œï¼Œå°‡ç‹€æ…‹è¨­ç‚º `await_reason`ï¼Œå„²å­˜å·²é¸çš„å‡åˆ¥èˆ‡æ—¥æœŸ
- å›žè¦† Flex Message æç¤ºè¼¸å…¥åŽŸå› ï¼Œä¸¦æä¾›ã€Œä¸å¡«åŽŸå› ã€å¿«æ·æŒ‰éˆ•
- å“¡å·¥è¼¸å…¥æ–‡å­—å¾Œï¼Œç³»çµ±åˆ¤æ–·ç›®å‰åœ¨ `await_reason` æ­¥é©Ÿï¼Œå°‡æ–‡å­—ä½œç‚ºåŽŸå› é€å‡ºç”³è«‹
- æ–°å¢ž postback `action=skip_reason` è·³éŽåŽŸå› ç›´æŽ¥é€å‡º

## 2. å‡åˆ¥åˆ†é¡žï¼šå¸¸ç”¨å‡åˆ¥ + ã€Œå…¶ä»–ã€å±•é–‹

å°‡å–ªå‡ã€ç”¢å‡ã€å©šå‡æ­¸é¡žç‚ºä¸å¸¸ç”¨å‡åˆ¥ï¼š

- é è¨­é¡¯ç¤ºå¸¸ç”¨å‡åˆ¥ï¼ˆç‰¹ä¼‘ã€ç—…å‡ã€äº‹å‡ï¼‰çš„å¡ç‰‡
- é¡å¤–æ–°å¢žä¸€å€‹ã€Œå…¶ä»–å‡åˆ¥ã€å¡ç‰‡ï¼Œé»žæ“Šå¾Œï¼ˆpostback `action=show_other_types`ï¼‰å±•ç¤ºå–ªå‡ã€ç”¢å‡ã€å©šå‡çš„é¸æ“‡å¡ç‰‡
- åˆ†é¡žé‚è¼¯å¯«åœ¨ Edge Function ä¸­ï¼Œæ ¹æ“šå‡åˆ¥åç¨±å€åˆ†ï¼ˆå¸¸ç”¨ï¼šç‰¹ä¼‘/ç—…å‡/äº‹å‡ï¼Œå…¶ä»–ï¼šå…¶é¤˜æ‰€æœ‰å‡åˆ¥ï¼‰

## 3. ã€ŒæŸ¥è©¢å‡æœŸã€æ”¹ç‚ºã€ŒæŸ¥è©¢ä¼‘å‡é¤˜é¡ã€

- å°‡é—œéµå­—å¾ž `æŸ¥è©¢å‡æœŸ` æ”¹ç‚º `æŸ¥è©¢ä¼‘å‡`ï¼ˆåŒæ™‚ä¿ç•™ `æŸ¥è©¢å‡æœŸ` å’Œ `å‡æœŸé¤˜é¡` ä½œç‚ºå…¼å®¹é—œéµå­—ï¼‰
- Quick Reply é¸é …æ–‡å­—æ”¹ç‚ºã€ŒðŸ“Š æŸ¥è©¢ä¼‘å‡ã€
- Flex Message æ¨™é¡Œä¿æŒã€ŒæŸ¥è©¢ä¼‘å‡ã€

## 4. é è¨­å›žè¦†æ”¹ç‚ºæç¤ºä½¿ç”¨ Rich Menu

- å°‡é è¨­å›žè¦†ï¼ˆç›®å‰é¡¯ç¤º Quick Reply é¸å–®ï¼‰æ”¹ç‚ºæç¤ºæ–‡å­—ï¼Œå‘ŠçŸ¥ä½¿ç”¨è€…é€éŽä¸‹æ–¹é¸å–®æ“ä½œ
- ä¿ç•™ Quick Reply ä½œç‚ºå‚™ç”¨ï¼Œä½†ä¸»è¦æ–‡å­—æ”¹ç‚ºå¼•å°Žä½¿ç”¨åœ–æ–‡é¸å–®
- å°æ–¼å®Œå…¨ç„¡æ³•è¾¨è­˜çš„æŒ‡ä»¤ï¼Œå›žè¦†ç°¡çŸ­æç¤ºè€Œéžå®Œæ•´é¸å–®

## ä¿®æ”¹æª”æ¡ˆ


| æª”æ¡ˆ                                         | æ”¹å‹•å…§å®¹     |
| ------------------------------------------ | -------- |
| `supabase/functions/line-webhook/index.ts` | æ‰€æœ‰ 4 é …æ”¹å‹• |


## æŠ€è¡“ç´°ç¯€

### æ–°å¢žçš„ Flex Messageï¼šå¡«å¯«åŽŸå› æç¤º

```text
+---------------------------+
|  ðŸ“ äº‹å‡ - å¡«å¯«åŽŸå›          |
|---------------------------|
|  é–‹å§‹ï¼š2026-03-01           |
|  çµæŸï¼š2026-03-02           |
|                           |
|  è«‹è¼¸å…¥ä¼‘å‡åŽŸå›              |
|  [ðŸ“Œ ä¸å¡«åŽŸå› ï¼Œç›´æŽ¥é€å‡º]    |
|  [âŒ å–æ¶ˆ]                 |
+---------------------------+
```

### å‡åˆ¥åˆ†é¡žæµç¨‹

```text
å“¡å·¥é»žã€Œç”³è«‹ä¼‘å‡ã€
  -> é¡¯ç¤ºï¼šç‰¹ä¼‘ã€ç—…å‡ã€äº‹å‡ã€[å…¶ä»–å‡åˆ¥]
     -> é»žã€Œå…¶ä»–å‡åˆ¥ã€
        -> é¡¯ç¤ºï¼šå©šå‡ã€ç”¢å‡ã€å–ªå‡ï¼ˆåŠå…¶ä»–ç®¡ç†å“¡æ–°å¢žçš„å‡åˆ¥ï¼‰
```

### ç‹€æ…‹æµç¨‹ï¼ˆæ›´æ–°å¾Œï¼‰

1. `select_leave` -> è¨­ç‹€æ…‹ `await_start_date`
2. `pick_start_date` -> è¨­ç‹€æ…‹ `await_end_date`
3. `pick_end_date` / `same_day` -> è¨­ç‹€æ…‹ `await_reason`ï¼ˆæ–°å¢žï¼‰
4. è¼¸å…¥åŽŸå› æ–‡å­— / `skip_reason` -> é€å‡ºç”³è«‹ã€æ¸…é™¤ç‹€æ…‹

### é—œéµå­—å°æ‡‰ï¼ˆæ›´æ–°å¾Œï¼‰

- ã€Œç”³è«‹ä¼‘å‡ã€-> é¡¯ç¤ºå‡åˆ¥é¸æ“‡
- ã€ŒæŸ¥è©¢ä¼‘å‡é¤˜é¡ã€/ã€ŒæŸ¥è©¢å‡æœŸã€/ã€Œå‡æœŸé¤˜é¡ã€-> é¡¯ç¤ºé¤˜é¡
- ã€Œä¼‘å‡æ˜Žç´°ã€-> é¡¯ç¤ºæ˜Žç´°
- ã€Œç•¶æœˆä¼‘å‡ã€-> é¡¯ç¤ºç•¶æœˆæ¸…å–®